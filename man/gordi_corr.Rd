% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gordi_corr.R
\name{gordi_corr}
\alias{gordi_corr}
\title{Correlate Environmental Variables with Ordination Axes}
\usage{
gordi_corr(
  pass,
  variables = "",
  permutations = 0,
  p_val_adjust = TRUE,
  p_val_adjust_method = "bonferroni",
  strata = NULL,
  scaling_coefficient = 0.9,
  label = c("covariate", "variable_level", "variable"),
  show_label = F,
  repel_label = F,
  colour = "",
  fill = "",
  alpha = "",
  linetype = "",
  linewidth = "",
  shape = "",
  size = "",
  arrow_size = 0.3
)
}
\arguments{
\item{pass}{A list object produced by \code{\link{gordi_read}()} and containing the ordination results (\code{pass$m}) and environmental data (\code{pass$env}).}

\item{variables}{Character vector; names of the environmental variables (columns in \code{pass$env}) to fit onto the ordination. Required.}

\item{permutations}{Numeric; The number of permutations to use for significance testing with \code{\link[vegan]{envfit}}. Set to 0 to skip testing. Default is 0 (no test).}

\item{p_val_adjust}{Logical; Should p-values be adjusted for multiple comparisons? Uses an internal wrapper by David Zelen√Ω around \code{\link[stats]{p.adjust}}, called \code{p.adjust.envfit}. Default is \code{TRUE}.}

\item{p_val_adjust_method}{Character; The method for p-value adjustment. See \code{\link[stats]{p.adjust}}. Default is 'bonferroni'.}

\item{strata}{Grouping variable for permutations. See details in \code{\link[vegan]{envfit}}.}

\item{label}{Character; The column from \code{pass$corr_coords} to use for the text labels. Must be one of 'covariate', 'variable_level', or 'variable'. Default is 'covariate'.}

\item{show_label}{Logical; If \code{TRUE}, plot text labels for the vectors and factor centroids. Default is \code{FALSE}.}

\item{repel_label}{Logical; If \code{TRUE} (and \code{show_label} is \code{TRUE}), use \code{\link[ggrepel]{geom_text_repel}} to prevent label overlap. Default is \code{FALSE}.}

\item{colour}{Aesthetic; A column name to map to the colour of vectors (line) and factor centroids (point or point outline for shapes 21-25), or a constant colour.}

\item{fill}{Aesthetic; A column name to map to the fill colour of factor centroids (only works with shapes 21-25), or a constant colour.}

\item{alpha}{Aesthetic; A column name to map to transparency, or a constant numeric value (0 to 1).}

\item{linetype}{Aesthetic; A column name to map to linetype (vectors only), or a constant linetype (e.g., 1, 2, 'dotted', 'dashed').}

\item{linewidth}{Aesthetic; A column name to map to line width (vectors only), or a constant numeric value.}

\item{shape}{Aesthetic; A column name to map to point shape (factors only), or a constant numeric value (point shape).}

\item{size}{Aesthetic; A column name to map to point size (factors only), or a constant numeric value.}

\item{arrow_size}{Numeric; Size of the arrow heads for vectors, in 'cm'. Default is 0.3.}
}
\value{
The updated \code{pass} object with the environmental correlation layers added to \code{pass$plot} and the correlation statistics added to \code{pass$corr_stats}.
}
\description{
Passively fits environmental variables (vectors for numeric, centroids for factors) onto
the current ordination plot stored in \code{pass$plot} using \code{\link[vegan]{envfit}}. 
If the number of permutations is provided, it can also calculate R2, p-values (or adjusted p-values)
for the correlation. These values are then stored in \code{pass$corr_stats}.
}
\details{
The function calculates the correlation scores (vectors and factor centroids)
and optionally adjusts the p-values for multiple testing.

\strong{Plotting:}
\itemize{
  \item \strong{Vectors} (for numeric variables) are plotted as arrows using \code{\link[ggplot2]{geom_segment}}.
  \item \strong{Centroids} (for factor levels) are plotted as points using \code{\link[ggplot2]{geom_point}}.
}

Aesthetic arguments (\code{colour}, \code{fill}, \code{alpha}, etc.) can be set in two ways:
\enumerate{
  \item \strong{Mapping:} If the argument matches a column name in the internal \code{pass$corr_coords} data frame (e.g., 'covariate', 'variable_level', 'variable'), the aesthetic is mapped to that variable.
  \item \strong{Constant:} Otherwise, the value is used as a constant aesthetic (e.g., \code{colour = 'red'}).
}

Use \code{\link{gordi_colour}()} or \code{\link{gordi_shape}()} or other similar functions immediately after \code{gordi_corr()}
to define custom legends and scales for mapped aesthetics. If you want to change `fill`, use \code{gordi_colour(fill = T)}.
}
\examples{
\dontrun{
data(dune)
data(dune.env)

m <- capscale(sqrt(dune) ~ 1)

# 1. Plot correlated variables
gordi_read(m, env = dune.env) |> 
  gordi_corr(variables = c('A1', 'Management', 'Use'))

# 2. Check stats
o <- gordi_read(m, env = dune.env) |> 
  gordi_corr(variables = c('A1', 'Management', 'Use'))    
  
o$corr_stats

# 3. Map colour to 'covariate' (Discrete)
gordi_read(m, env = dune.env) |> 
  gordi_corr(variables = c('A1', 'Management', 'Use'), colour = 'covariate') |> 
  gordi_colour(scale = 'discrete', family = 'viridis')
}
}
